angular.module("ivh.treeview",[]),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateEndSymbol","}}"),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateStartSymbol","{{"),angular.module("ivh.treeview").directive("ivhTreeviewCheckboxHelper",[function(){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewCheckboxHelper"},require:"^ivhTreeview",link:function(e,t,i,n){var r=e.node,l=n.opts(),o=l.indeterminateAttribute,a=l.selectedAttribute;e.isSelected=r[a],e.trvw=n,e.resolveIndeterminateClick=function(){l.disableCheckboxSelectionPropagation||r[o]&&n.select(r,!0)},e.$watch("node."+a,function(t,i){e.isSelected=t}),l.disableCheckboxSelectionPropagation||e.$watch("node."+o,function(e,i){t.find("input").prop("indeterminate",e)})},template:['<input type="checkbox"','class="ivh-treeview-checkbox"','ng-model="isSelected"','ng-click="resolveIndeterminateClick()"','ng-change="trvw.select(node, isSelected)" />'].join("\n")}}]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{restrict:"AE",require:"^ivhTreeview",template:'<span ivh-treeview-checkbox-helper="node"></span>'}}]),angular.module("ivh.treeview").directive("ivhTreeviewChildren",function(){"use strict";return{restrict:"AE",require:"^ivhTreeviewNode",template:['<ul ng-if="trvw.renderChildren(node)" class="ivh-treeview">','<li ng-repeat="child in getChildren()"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="childDepth">',"</li>","</ul>"].join("\n")}}),angular.module("ivh.treeview").directive("ivhTreeviewNode",["ivhTreeviewCompiler",function(e){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewNode",depth:"=ivhTreeviewDepth"},require:"^ivhTreeview",compile:function(t){return e.compile(t,function(e,t,i,n){var r=e.node,l=e.getChildren=function(){return n.children(r)};e.trvw=n,e.childDepth=e.depth+1,n.isExpanded(r)||n.expand(r,n.isInitiallyExpanded(e.depth)),e.$watch(function(){return l().length>0},function(e){e?t.removeClass("ivh-treeview-node-leaf"):t.addClass("ivh-treeview-node-leaf")})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewToggle",[function(){"use strict";return{restrict:"A",require:"^ivhTreeview",link:function(e,t,i,n){var r=e.node;t.addClass("ivh-treeview-toggle"),t.bind("click",function(){n.isLeaf(r)||e.$apply(function(){n.toggleExpanded(r),n.onToggle(r)})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewTwistie",["$compile","ivhTreeviewOptions",function(e,t){"use strict";var i=t();return{restrict:"A",require:"^ivhTreeview",template:['<span class="ivh-treeview-twistie">','<span class="ivh-treeview-twistie-collapsed">',i.twistieCollapsedTpl,"</span>",'<span class="ivh-treeview-twistie-expanded">',i.twistieExpandedTpl,"</span>",'<span class="ivh-treeview-twistie-leaf">',i.twistieLeafTpl,"</span>","</span>"].join("\n"),link:function(t,n,r,l){if(l.hasLocalTwistieTpls){var o=l.opts(),a=n.children().eq(0).children();angular.forEach(["twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl"],function(n,r){var l=o[n],d=i[n];if(l&&l!==d){"<"===l.substr(0,1)&&">"===l.substr(-1,1)||(l="<span>"+l+"</span>");var s=e(l)(t);a.eq(r).html("").append(s)}})}}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["ivhTreeviewMgr",function(e){"use strict";return{restrict:"A",transclude:!0,scope:{root:"=ivhTreeview",childrenAttribute:"=ivhTreeviewChildrenAttribute",defaultSelectedState:"=ivhTreeviewDefaultSelectedState",disableCheckboxSelectionPropagation:"=ivhTreeviewDisableCheckboxSelectionPropagation",expandToDepth:"=ivhTreeviewExpandToDepth",idAttribute:"=ivhTreeviewIdAttribute",indeterminateAttribute:"=ivhTreeviewIndeterminateAttribute",expandedAttribute:"=ivhTreeviewExpandedAttribute",labelAttribute:"=ivhTreeviewLabelAttribute",nodeTpl:"=ivhTreeviewNodeTpl",selectedAttribute:"=ivhTreeviewSelectedAttribute",onCbChange:"&ivhTreeviewOnCbChange",onToggle:"&ivhTreeviewOnToggle",twistieCollapsedTpl:"=ivhTreeviewTwistieCollapsedTpl",twistieExpandedTpl:"=ivhTreeviewTwistieExpandedTpl",twistieLeafTpl:"=ivhTreeviewTwistieLeafTpl",useCheckboxes:"=ivhTreeviewUseCheckboxes",validate:"=ivhTreeviewValidate",visibleAttribute:"=ivhTreeviewVisibleAttribute",renderChildrenOnExpand:"=ivhTreeviewRenderChildrenOnExpand",userOptions:"=ivhTreeviewOptions",filter:"=ivhTreeviewFilter"},controllerAs:"trvw",controller:["$scope","$element","$attrs","$transclude","ivhTreeviewOptions","filterFilter",function(t,i,n,r,l,o){var a=angular,d=this,s=a.extend({},l(),t.userOptions);a.forEach(["childrenAttribute","defaultSelectedState","disableCheckboxSelectionPropagation","expandToDepth","idAttribute","indeterminateAttribute","expandedAttribute","labelAttribute","nodeTpl","selectedAttribute","twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl","useCheckboxes","validate","visibleAttribute","renderChildrenOnExpand"],function(e){a.isDefined(t[e])&&(s[e]=t[e])});var c=function(e){return"ivhTreeview"+e.charAt(0).toUpperCase()+e.slice(1)};a.forEach(["onCbChange","onToggle"],function(e){n[c(e)]&&(s[e]=t[e])});var u;r(function(e,t){var i="";angular.forEach(e,function(e){i+=(e.innerHTML||"").trim()}),i.length&&(u=t,s.nodeTpl=i)}),d.opts=function(){return s};var v=t.userOptions||{};d.hasLocalTwistieTpls=!!(v.twistieCollapsedTpl||v.twistieExpandedTpl||v.twistieLeafTpl||t.twistieCollapsedTpl||t.twistieExpandedTpl||t.twistieLeafTpl),d.children=function(e){var t=e[s.childrenAttribute];return a.isArray(t)?t:[]},d.label=function(e){return e[s.labelAttribute]},d.hasFilter=function(){return a.isDefined(t.filter)},d.getFilter=function(){return t.filter||""},d.isVisible=function(e){var t=d.getFilter();if(!t||o([e],t).length)return!0;if("object"==typeof t||"function"==typeof t)for(var i=d.children(e),n=i.length;n--;)if(d.isVisible(i[n]))return!0;return!1},d.useCheckboxes=function(){return s.useCheckboxes},d.select=function(i,n){e.select(t.root,i,s,n),d.onCbChange(i,n)},d.isSelected=function(e){return e[s.selectedAttribute]},d.toggleSelected=function(e){var t=!e[s.selectedAttribute];d.select(e,t)},d.expand=function(i,n){e.expand(t.root,i,s,n)},d.isExpanded=function(e){return e[s.expandedAttribute]},d.renderChildren=function(e){return s.renderChildrenOnExpand?e[s.renderChildrenAttribute]:d.children(e).length},d.toggleExpanded=function(e){d.expand(e,!d.isExpanded(e))},d.isInitiallyExpanded=function(e){return e<(-1===s.expandToDepth?1/0:s.expandToDepth)},d.isLeaf=function(e){return 0===d.children(e).length},d.getNodeTpl=function(){return s.nodeTpl},d.root=function(){return t.root},d.onToggle=function(e){if(s.onToggle){var i={ivhNode:e,ivhIsExpanded:d.isExpanded(e),ivhTree:t.root};s.onToggle(i)}},d.onCbChange=function(e,i){if(s.onCbChange){var n={ivhNode:e,ivhIsSelected:i,ivhTree:t.root};s.onCbChange(n)}}}],link:function(t,i,n){var r=t.trvw.opts();r.validate&&e.validate(t.root,r)},template:['<ul class="ivh-treeview">','<li ng-repeat="child in root | ivhTreeviewAsArray"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="0">',"</li>","</ul>"].join("\n")}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(e){return!angular.isArray(e)&&angular.isObject(e)?[e]:e}}),angular.module("ivh.treeview").factory("ivhTreeviewBfs",["ivhTreeviewOptions",function(e){"use strict";var t=angular;return function(i,n,r){2===arguments.length&&t.isFunction(n)&&(r=n,n={}),n=angular.extend({},e(),n),r=r||t.noop;var l,o,a,d,s,c=[],u=n.childrenAttribute;for(t.isArray(i)?(t.forEach(i,function(e){c.push([e,[]])}),l=c.shift()):l=[i,[]];l;){if(o=l[0],a=l[1],!1!==r(o,a)&&o[u]&&t.isArray(o[u]))for(s=o[u].length,d=0;d<s;d++)c.push([o[u][d],[o].concat(a)]);l=c.shift()}}}]),angular.module("ivh.treeview").factory("ivhTreeviewCompiler",["$compile",function(e){"use strict";return{compile:function(t,i){angular.isFunction(i)&&(i={post:i});var n;return{pre:i&&i.pre?i.pre:null,post:function(t,r,l,o){n||(n=e(o.getNodeTpl())),n(t,function(e){r.append(e)}),i&&i.post&&i.post.apply(null,arguments)}}}}}]),angular.module("ivh.treeview").factory("ivhTreeviewMgr",["ivhTreeviewOptions","ivhTreeviewBfs",function(e,t){"use strict";var i=angular,n=e(),r={},l=function(e){e[this.selectedAttribute]=!1,e[this.indeterminateAttribute]=!1},o=function(e){e[this.selectedAttribute]=!0,e[this.indeterminateAttribute]=!1},a=function(e){var t=e[this.childrenAttribute],n=this.selectedAttribute,r=this.indeterminateAttribute,l=0,o=0;i.forEach(t,function(e,t){e[n]?l++:e[r]&&o++}),0===l&&0===o?(e[n]=!1,e[r]=!1):l===t.length?(e[n]=!0,e[r]=!1):(e[n]=!1,e[r]=!0)},d=function(e){return i.isString(e)||i.isNumber(e)},s=function(e,i,n,r){var l=d(i),o=!0,a=n.idAttribute,s=null,c=[];return t(e,n,function(e,t){return o&&(l?i===e[a]:i===e)&&(o=!1,s=e,c=t),o}),r(s,c)};return r.select=function(e,s,c,u){arguments.length>2&&"boolean"==typeof c&&(u=c,c={}),c=i.extend({},n,c),u=!i.isDefined(u)||u;var v=d(s),h=!0,p=c.idAttribute;return t(e,c,function(e,n){if(h&&(v?s===e[p]:s===e)){h=!1;var r=u?o.bind(c):l.bind(c);c.disableCheckboxSelectionPropagation?r(e):(t(e,c,r),i.forEach(n,a.bind(c)))}return h}),r},r.selectAll=function(e,l,o){arguments.length>1&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=l.selectedAttribute,d=l.indeterminateAttribute;return t(e,l,function(e){e[a]=o,e[d]=!1}),r},r.selectEach=function(e,t,n,l){return i.forEach(t,function(t){r.select(e,t,n,l)}),r},r.deselect=function(e,t,i){return r.select(e,t,i,!1)},r.deselectAll=function(e,t){return r.selectAll(e,t,!1)},r.deselectEach=function(e,t,i){return r.selectEach(e,t,i,!1)},r.validate=function(e,l,o){if(!e)return r;arguments.length>1&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=i.isDefined(o)?o:l.defaultSelectedState;var a=l.selectedAttribute,d=l.indeterminateAttribute;return t(e,l,function(t,n){if(i.isDefined(t[a])&&t[a]!==o)return r.select(e,t,l,!o),!1;t[a]=o,t[d]=!1}),r},r.expand=function(e,t,l,o){arguments.length>2&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=d(t),c=l.expandedAttribute,u=l.renderChildrenAttribute;return a?s(e,t,l,function(e,t){return o&&(e[u]=!0),e[c]=o,r}):(o&&(t[u]=!0),t[c]=o,r)},r.expandRecursive=function(e,l,o,a){arguments.length>2&&"boolean"==typeof o&&(a=o,o={}),l=i.isDefined(l)?l:e,o=i.extend({},n,o),a=!i.isDefined(a)||a;var c,u=d(l),v=o.expandedAttribute,h=o.renderChildrenAttribute;return u?s(e,l,o,function(e,t){c=e}):c=l,c&&t(c,o,function(e,t){a&&(e[h]=!0),e[v]=a}),r},r.collapse=function(e,t,i){return r.expand(e,t,i,!1)},r.collapseRecursive=function(e,t,i,n){return r.expandRecursive(e,t,i,!1)},r.expandTo=function(e,t,l,o){arguments.length>2&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=l.expandedAttribute,d=l.renderChildrenAttribute,c=function(e){o&&(e[d]=!0),e[a]=o};return s(e,t,l,function(e,t){return i.forEach(t,c),r})},r.collapseParents=function(e,t,i){return r.expandTo(e,t,i,!1)},r}]),angular.module("ivh.treeview").provider("ivhTreeviewOptions",["ivhTreeviewInterpolateStartSymbol","ivhTreeviewInterpolateEndSymbol",function(e,t){"use strict";var i=e,n=t,r={idAttribute:"id",labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,disableCheckboxSelectionPropagation:!1,validate:!0,indeterminateAttribute:"__ivhTreeviewIndeterminate",expandedAttribute:"__ivhTreeviewExpanded",renderChildrenOnExpand:!1,renderChildrenAttribute:"__ivhTreeviewRenderChildren",defaultSelectedState:!0,twistieExpandedTpl:"(-)",twistieCollapsedTpl:"(+)",twistieLeafTpl:"o",nodeTpl:['<div class="ivh-treeview-node-content" title="{{trvw.label(node)}}">',"<span ivh-treeview-toggle>",'<span class="ivh-treeview-twistie-wrapper" ivh-treeview-twistie></span>',"</span>",'<span class="ivh-treeview-checkbox-wrapper" ng-if="trvw.useCheckboxes()"',"ivh-treeview-checkbox>","</span>",'<span class="ivh-treeview-node-label" ivh-treeview-toggle>',"{{trvw.label(node)}}","</span>","<div ivh-treeview-children></div>","</div>"].join("\n").replace(new RegExp("{{","g"),i).replace(new RegExp("}}","g"),n)};this.set=function(e){angular.extend(r,e)},this.$get=function(){return function(){return angular.copy(r)}}}]);